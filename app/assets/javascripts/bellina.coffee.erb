$.fn.extend {
  integrateSelect2: (selector)->
    selector = selector || '.select2'
    $(@).find(selector).select2({
      theme: "bootstrap",
      width: '100%',
      allowClear: false
    })

  integrateDatepicker: (selector)->
    selector = selector || '.datepicker'
    $(@).find(selector).datepicker({
      startView: 1,
      language: "es",
      orientation: "bottom auto",
      autoclose: true,
      todayHighlight: true,
      todayBtn: "linked",
      clearBtn: true,
      dateFormat: "dd-mm-yyyy"

    })
}



###
# Number.prototype.format(n, x, s, c)
#
# @param integer n: length of decimal
# @param integer x: length of whole part
# @param mixed   s: sections delimiter
# @param mixed   c: decimal delimiter
###

Number::format = (n, x, s, c) ->
  re = '\\d(?=(\\d{' + (x or 3) + '})+' + (if n > 0 then '\\D' else '$') + ')'
  num = @toFixed(Math.max(0, ~ ~n))
  (if c then num.replace('.', c) else num).replace new RegExp(re, 'g'), '$&' + (s or ',')

$(document).ready ->
  $('[data-toggle="tooltip"]').tooltip()
  datatable = $('.datatable')
  datatable.DataTable
    'language': 'url': '//cdn.datatables.net/plug-ins/9dcbecd42ad/i18n/Spanish.json'
    'bPaginate': true
    'info': false
    'responsive': true
    'deferRender': true
    'stateSave': true
  form = $('form')
  form.integrateSelect2()
  form.integrateDatepicker()


  set_events()



$(document).on 'turbolinks:load', ->
  $('[data-toggle="tooltip"]').tooltip()
  datatable = $('.datatable')
  datatable.DataTable
    'language': 'url': '//cdn.datatables.net/plug-ins/9dcbecd42ad/i18n/Spanish.json'
    'bPaginate': true
    'info': false
    'responsive': true
    'deferRender': true
    'stateSave': true

  form = $('form')
  form.integrateSelect2()
  form.integrateDatepicker()


  set_events()

$ ->
  $('[data-toggle="tooltip"]').tooltip()



$(document).on 'turbolinks:before-cache', ->
    dataTable =  $($.fn.dataTable.tables(true)).DataTable()
    if (dataTable != null)
     dataTable.destroy();


$(document).on 'turbolinks:load', ->
  $('.footwears.new #footwear_release_country_id').val(11).trigger('change');
  if ($('.sales.edit').length > 0)
    calc_total()

$(document).on 'cocoon:after-insert', (e) ->
  $('.select2').select2({theme: "bootstrap",width: '100%'})
  set_events()


$(document).on 'cocoon:after-remove', (e) ->
  if ($('.sales.new').length + $('.sales.edit').length > 0)
    calc_total()

onScan.attachTo document
# Register event listener
document.addEventListener 'scan', (sScancode, iQuatity) ->
  if ($('.welcome.index').length > 0)
    $.ajax
      type: 'POST'
      url: '/get_footwear_id/'+sScancode.detail.scanCode
      error: (jqXHR, textStatus, errorThrown) ->
        return
      success: (data) ->
        window.location.replace("/footwears/" + data.id);
